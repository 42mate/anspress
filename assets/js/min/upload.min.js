!function(a){function b(a){var b=["Bytes","KB","MB","GB","TB"];if(0==a)return"0 Byte";var c=parseInt(Math.floor(Math.log(a)/Math.log(1024)));return Math.round(a/Math.pow(1024,c),2)+" "+b[c]}function c(a){return/[.]/.exec(a)?/[^.]+$/.exec(a):void 0}a(document).ready(function(){a('.ap-field-type-upload input[type="file"]').on("change",function(){var d=a(this).data("upload"),e=a(this).closest(".ap-form-group"),f=a(this).parent().find("b");e.removeClass("ap-have-errors"),e.find(".ap-field-errors").remove(),a(this).parent().prev().is(".ap-upload-list")&&a(this).parent().prev().remove(),a('<div class="ap-upload-list"></div>').insertBefore(a(this).parent()),this.files.length>d.max_files&&(AnsPress.trigger("snackbar",{snackbar:{success:!1,message:d.label_max_added}}),e.addClass("ap-have-errors"),a('<div class="ap-field-errors"><span class="ap-field-error">'+d.label_max_added+"</span></div>").insertBefore(e.find(".ap-upload-list"))),f.text(0);for(var g=0;g<this.files.length;g++){var h=this.files[g],i=c(h.name);a(this).attr("accept").indexOf(i)===-1&&(AnsPress.trigger("snackbar",{snackbar:{success:!1,message:d.label_deny_type}}),e.addClass("ap-have-errors")),a('<div><span class="ext">'+i+"</span>"+h.name+'<span class="size">'+b(h.size)+"</span></div>").appendTo(a(this).parent().prev()),f.text(g+1)}})}),AnsPress.on("selectImage",function(b){b=b||!1;var c=AnsPress.modal("selectImage");AnsPress.ajax({data:{action:"ap_select_image"},success:function(d){c.setTitle(d.title),c.setContent(d.content),c.setFooter(d.footer);var e=function(){c.$el.find(".ap-upload-err").remove(),a("#ap-image-preview").toggle(),a("#ap-imgdrop-area").toggle()},f=c.$el.find(".ap-btn-primary"),g=d.options;g.init={PostInit:function(){f.on("click",function(){AnsPress.uploader.start()})},FilesAdded:function(b,c){for(e(),f.prop("disabled",!1);b.files.length>1;)b.removeFile(b.files[0]);a("#ap-image-preview").html(""),a.each(c,function(){var b=new mOxie.Image;b.onload=function(){this.embed(a("#ap-image-preview").get(0))},b.onembedded=function(){this.destroy()},b.onerror=function(){this.destroy()},b.load(this.getSource())})},UploadProgress:function(a,b){AnsPress.showLoading(f)},FileUploaded:function(d,e,g){AnsPress.hideLoading(f);var h=AnsPress.ajaxResponse(g.response);return h.success?(b&&b(h),AnsPress.uploader.destroy(),void c.hide()):void a("#ap-imageu-c").prepend('<span class="ap-upload-err">'+h.snackbar.message+"</span>")},Error:function(b,d){d.file.percent>0&&e(),AnsPress.hideLoading(f),c.$el.find(".ap-upload-err").remove(),a("#ap-imageu-c").prepend('<span class="ap-upload-err">'+d.message+"</span>")}},AnsPress.uploader=new plupload.Uploader(g),AnsPress.uploader.init()}})})}(jQuery);
//# sourceMappingURL=upload.min.js.map