!function(a){AnsPress.loadTemplate("notifications"),AnsPress.models.Notification=Backbone.Model.extend({idAttribute:"ID",defaults:{ID:"",userID:"",avatar:"",content:"",actions:""}}),AnsPress.collections.Notifications=Backbone.Collection.extend({model:AnsPress.models.Notification}),AnsPress.views.Notification=Backbone.View.extend({id:function(){return"noti-"+this.model.id},template:AnsPress.getTemplate("notification"),initialize:function(a){this.model=a.model},events:{},render:function(){var a=_.template(this.template());return this.$el.html(a(this.model.toJSON())),this}}),AnsPress.views.Notifications=Backbone.View.extend({template:AnsPress.getTemplate("notifications"),initialize:function(a){this.model=a.model},renderItem:function(a){this.$el.parent().addClass("have-comments");var b=new AnsPress.views.Notification({model:a});return this.$el.find(".scroll-wrap").append(b.render().$el),b},render:function(){var a=this,b=_.template(this.template());return this.$el.html(b()),this.model.length>0&&this.model.each(function(b){a.renderItem(b)}),this},removeComment:function(a){this.model.remove(a)},commentRemoved:function(b){0===this.model.size()&&this.$el.parent().removeClass("have-comments"),a("#comment-"+b.id).slideUp(400,function(){a(this).remove()})},newComment:function(a){var b=this.renderItem(a);b.$el.hide().slideDown(400),this.$el.apScrollTo("#comment-"+a.id)}});var b=Backbone.Router.extend({routes:{apNotifications:"notiRoute"},dpPos:function(a,b){var c=b.offset();c.top=c.top+b.height(),c.left=c.left-a.width()+b.width(),a.css(c)},notiRoute:function(b,c){var d=this;AnsPress.ajax({data:ajaxurl+"?action=ap_ajax&ap_ajax_action=get_notifications",success:function(b){var c=a(".anspress-menu-notifications"),e=a("#noti-dp");if(b.success){if(0==e.length){var f=a('<div id="noti-dp"></div>');a("body").append(f),d.dpPos(f,c)}var g=new AnsPress.collections.Notifications(b.notifications),h=new AnsPress.views.Notifications({model:g});a("#noti-dp").html(h.render().$el)}}})}});a(document).ready(function(){new b;Backbone.history.start()})}(jQuery);