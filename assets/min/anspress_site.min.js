window.AnsPress=_.extend({models:{},views:{},collections:{},loadTemplate:function(a,b){var c=this;0===jQuery("#apTemplate-"+a).length&&(jQuery('<script id="apTemplate-'+a+'" type="text/html"></script>').appendTo("body"),jQuery.get(apTemplateUrl+"/"+a+".html",function(d){jQuery("#apTemplate-"+a).html(d),c.trigger("templateLoaded-"+a,d),b&&b(d)}))},isJSONString:function(a){try{return JSON.parse(a)}catch(b){return!1}},ajaxResponse:function(a){if(a=jQuery(a),"undefined"==typeof a.filter("#ap-response"))return console.log("Not a valid AnsPress ajax response."),{};var b=this.isJSONString(a.filter("#ap-response").html());return b&&"undefined"!==b&&_.isObject(b)?b:{}},ajax:function(a){var b=this;a=_.defaults(a,{url:ajaxurl,method:"POST"}),_.isObject(a.data)&&(a.data=jQuery.param(a.data)),a.data="action=ap_ajax&"+a.data;var c=a.success;return delete a.success,a.success=function(d){var e=b.ajaxResponse(d);if(e.snackbar&&AnsPress.trigger("snackbar",e),"function"==typeof c){d=jQuery.isEmptyObject(e)?d:e;var f=a.context||null;c(d,f)}},jQuery.ajax(a)}},Backbone.Events),_.templateSettings={evaluate:/<#([\s\S]+?)#>/g,interpolate:/\{\{\{([\s\S]+?)\}\}\}/g,escape:/\{\{([^\}]+?)\}\}(?!\})/g},function(a){AnsPress.models.Post=Backbone.Model.extend({idAttribute:"ID",defaults:{user:{ID:"",avatar:"",displayMeta:"",profileLink:!1},activity:"",actions:[{id:"comment",label:"Comment"},{id:"select",label:"Select"},{id:"edit",label:"Edit"},{id:"status",label:"Status",sub:[{id:"publish",label:"Publish"},{id:"trash",label:"Trash"},{id:"private",label:"Private"},{id:"moderate",label:"Moderate"}]}],comments:{},dateTime:"",postedOn:"",voteButton:""}}),AnsPress.views.Vote=Backbone.View.extend({idAttribute:"ID"}),AnsPress.views.Post=Backbone.View.extend({idAttribute:"ID",templateId:"answer",tagName:"div",id:function(){return"answer_"+this.model.get("ID")},initialize:function(a){this.model.on("change",this.render,this),AnsPress.on("templateLoaded-"+this.templateId,this.templateLoaded,this),AnsPress.loadTemplate(this.templateId)},templateLoaded:function(a){this.template=a,this.render()},events:{"click [ap-btnvote]":"voteClicked"},voteClicked:function(b){if(b.preventDefault(),!a(b.target).is(".disable")){self=this;var c=a(b.target).data("type"),d=_.clone(self.model.get("vote"));"vote_up"===c?d.net="vote_up"===d.active?d.net-1:d.net+1:d.net="vote_down"===d.active?d.net+1:d.net-1,self.model.set("vote",d);var e=a(b.target).attr("ap-btnvote");AnsPress.ajax({url:ajaxurl,method:"POST",data:"ap_ajax_action=vote&"+e,success:function(a){a.success&&self.model.set("vote",a.voteData)}})}},voteClass:function(a){a=a||"vote_up";var b=this.model.get("vote").active,c="";return"vote_up"===b&&"vote_up"===a&&(c="active"),"vote_down"===b&&"vote_down"===a&&(c="active"),a!==b&&""!==b&&(c+="disable"),c},render:function(){if(this.template){var a=_.template(this.template);this.$el.attr("class",this.model.get("class"));var b=_.extend(this.model.toJSON(),{voteUpClass:this.voteClass("vote_up"),voteDownClass:this.voteClass("vote_down")});this.$el.html(a(b))}return this}}),AnsPress.collections.Posts=Backbone.Collection.extend({model:AnsPress.models.Post,url:ajaxurl+"?action=fetch_answers&question_id="+apQuestionID}),AnsPress.views.Posts=Backbone.View.extend({initialize:function(){this.model.on("add",this.renderItem,this)},renderItem:function(a){var b=new AnsPress.views.Post({model:a});this.el.append(b.render().el)},render:function(){var a=this;return this.model.each(function(b){a.renderItem(b)}),a}}),AnsPress.views.Snackbar=Backbone.View.extend({id:"ap-snackbar",template:'<div class="ap-snackbar<# if(success){ #> success<# } #>">{{message}}</div>',hover:!1,initialize:function(){AnsPress.on("snackbar",this.show,this)},events:{mouseover:"toggleHover",mouseout:"toggleHover"},show:function(a){var b=this;this.data=a.snackbar,this.data.success=a.success,this.$el.removeClass("snackbar-show"),this.render(),setTimeout(function(){b.$el.addClass("snackbar-show")},0),this.hide()},toggleHover:function(){clearTimeout(this.hoveTimeOut),this.hover=!this.hover,this.hover||this.hide()},hide:function(){var a=this;a.hover||(this.hoveTimeOut=setTimeout(function(){a.$el.removeClass("snackbar-show")},2e3))},render:function(){if(this.data){var a=_.template(this.template);this.$el.html(a(this.data))}return this}})}(jQuery);var apposts=new AnsPress.collections.Posts;apposts.fetch();var appostview=new AnsPress.views.Posts({model:apposts});jQuery("#answers").html(appostview.render().$el);var apSnackbarView=new AnsPress.views.Snackbar;jQuery("body").append(apSnackbarView.render().$el);